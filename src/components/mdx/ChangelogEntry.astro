---
/**
 * ChangelogEntry - Individual changelog entry in the timeline
 *
 * Props:
 * - version: Version string (e.g., "2.0.0")
 * - date: Release date (e.g., "2024-01-15")
 * - type: Release type - 'major' | 'minor' | 'patch' | 'beta' | 'alpha'
 * - badge: Optional custom badge text (e.g., "Latest", "LTS")
 * - author: Optional author name
 * - githubRelease: Optional GitHub release URL
 */
import Icon from '../Icon.astro';

interface Props {
  version: string;
  date: string;
  type?: 'major' | 'minor' | 'patch' | 'beta' | 'alpha';
  badge?: string;
  author?: string;
  githubRelease?: string;
}

const { version, date, type = 'minor', badge, author, githubRelease } = Astro.props;

const typeConfig: Record<string, { icon: string; color: string; bgColor: string }> = {
  major: {
    icon: 'lucide:rocket',
    color: 'var(--danger)',
    bgColor: 'var(--danger-light)',
  },
  minor: {
    icon: 'lucide:sparkles',
    color: 'var(--info)',
    bgColor: 'var(--info-light)',
  },
  patch: {
    icon: 'lucide:wrench',
    color: 'var(--success)',
    bgColor: 'var(--success-light)',
  },
  beta: {
    icon: 'lucide:flask-conical',
    color: 'var(--warning)',
    bgColor: 'var(--warning-light)',
  },
  alpha: {
    icon: 'lucide:beaker',
    color: 'var(--note)',
    bgColor: 'var(--note-light)',
  },
};

const config = typeConfig[type] || typeConfig.minor;

// Format date
const formatDate = (dateStr: string) => {
  const d = new Date(dateStr);
  return d.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

// Badge variant based on type
const badgeVariants: Record<string, string> = {
  major: 'danger',
  minor: 'info',
  patch: 'success',
  beta: 'warning',
  alpha: 'default',
};
---

<div class="changelog-entry">
  <div class="timeline-marker" style={`--marker-color: ${config.color}; --marker-bg: ${config.bgColor};`}>
    <Icon name={config.icon} size={18} />
  </div>

  <div class="entry-content">
    <div class="entry-header">
      <div class="version-info">
        <h3 class="version-number">v{version}</h3>
        {badge && (
          <span class={`version-badge badge-${badgeVariants[type] || 'default'}`}>
            {badge}
          </span>
        )}
        <span class={`type-badge badge-${badgeVariants[type] || 'default'}`}>
          {type.charAt(0).toUpperCase() + type.slice(1)}
        </span>
      </div>
      <time class="release-date" datetime={date}>
        {formatDate(date)}
      </time>
    </div>

    <div class="entry-body">
      <slot />
    </div>

    {(author || githubRelease) && (
      <div class="entry-footer">
        {author && (
          <span class="author">
            <Icon name="lucide:user" size={14} />
            {author}
          </span>
        )}
        {githubRelease && (
          <a href={githubRelease} class="github-link" target="_blank" rel="noopener noreferrer">
            <Icon name="fa6-brands:github" size={14} />
            View on GitHub
          </a>
        )}
      </div>
    )}
  </div>
</div>

<style>
  .changelog-entry {
    position: relative;
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
  }

  .changelog-entry:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .timeline-marker {
    position: absolute;
    left: -2.5rem;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--marker-bg);
    color: var(--marker-color);
    border: 2px solid var(--marker-color);
    box-shadow: 0 0 0 4px var(--background);
    z-index: 1;
    flex-shrink: 0;
  }

  .entry-content {
    flex: 1;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
  }

  .changelog-entry:last-child .entry-content {
    border-bottom: none;
    padding-bottom: 0;
  }

  .entry-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .version-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .version-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--foreground);
    margin: 0;
    line-height: 1.2;
  }

  .version-badge,
  .type-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.625rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 9999px;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .badge-danger {
    background-color: var(--danger-light);
    color: var(--danger);
  }

  .badge-info {
    background-color: var(--info-light);
    color: var(--info);
  }

  .badge-success {
    background-color: var(--success-light);
    color: var(--success);
  }

  .badge-warning {
    background-color: var(--warning-light);
    color: var(--warning);
  }

  .badge-default {
    background-color: var(--muted);
    color: var(--muted-foreground);
  }

  .release-date {
    font-size: 0.875rem;
    color: var(--muted-foreground);
  }

  .entry-body {
    color: var(--muted-foreground);
    line-height: 1.6;
  }

  .entry-footer {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px dashed var(--border);
    font-size: 0.875rem;
    color: var(--muted-foreground);
  }

  .author {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .github-link {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--muted-foreground);
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .github-link:hover {
    color: var(--foreground);
  }
</style>
